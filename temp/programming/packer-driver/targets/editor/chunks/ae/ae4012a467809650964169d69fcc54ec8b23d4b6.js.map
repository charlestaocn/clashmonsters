{"version":3,"sources":["file:///C:/project/work/cocos/clashmonsters/assets/Scripts/Game/Items/ItemAttractor.ts"],"names":["ItemAttractor","getDirection","constructor","playerNode","speedIncreasePerSecond","items","speedValues","gameTick","deltaTime","i","length","direction","worldPosition","node","position","clone","x","y","setWorldPosition","addItem","item","includes","PickupEvent","on","removeItem","push","off","index","indexOf","splice"],"mappings":";;;6FAIaA,a;;;;;;;;;;;;;;;;;;;;AAHJC,MAAAA,Y,iBAAAA,Y;;;;;;;;;+BAGID,a,GAAN,MAAMA,aAAN,CAAoB;AAIhBE,QAAAA,WAAW,CAASC,UAAT,EAAmCC,sBAAnC,EAAmE;AAAA,eAH7EC,KAG6E,GAH7D,EAG6D;AAAA,eAF7EC,WAE6E,GAFrD,EAEqD;AAAA,eAA1DH,UAA0D,GAA1DA,UAA0D;AAAA,eAAhCC,sBAAgC,GAAhCA,sBAAgC;AAAE;;AAEhFG,QAAAA,QAAQ,CAACC,SAAD,EAA0B;AACrC,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKJ,KAAL,CAAWK,MAA/B,EAAuCD,CAAC,EAAxC,EAA4C;AACxC,kBAAME,SAAe,GAAG;AAAA;AAAA,8CAAa,KAAKR,UAAL,CAAgBS,aAA7B,EAA4C,KAAKP,KAAL,CAAWI,CAAX,EAAcI,IAAd,CAAmBD,aAA/D,CAAxB;AACA,kBAAME,QAAQ,GAAG,KAAKT,KAAL,CAAWI,CAAX,EAAcI,IAAd,CAAmBD,aAAnB,CAAiCG,KAAjC,EAAjB;AACAD,YAAAA,QAAQ,CAACE,CAAT,IAAcL,SAAS,CAACK,CAAV,GAAc,KAAKV,WAAL,CAAiBG,CAAjB,CAAd,GAAoCD,SAAlD;AACAM,YAAAA,QAAQ,CAACG,CAAT,IAAcN,SAAS,CAACM,CAAV,GAAc,KAAKX,WAAL,CAAiBG,CAAjB,CAAd,GAAoCD,SAAlD;AAEA,iBAAKH,KAAL,CAAWI,CAAX,EAAcI,IAAd,CAAmBK,gBAAnB,CAAoCJ,QAApC;AACA,iBAAKR,WAAL,CAAiBG,CAAjB,KAAuB,KAAKL,sBAAL,GAA8BI,SAArD;AACH;AACJ;;AAEMW,QAAAA,OAAO,CAACC,IAAD,EAAmB;AAC7B,cAAI,KAAKf,KAAL,CAAWgB,QAAX,CAAoBD,IAApB,CAAJ,EAA+B;AAE/BA,UAAAA,IAAI,CAACE,WAAL,CAAiBC,EAAjB,CAAoB,KAAKC,UAAzB,EAAqC,IAArC;AAEA,eAAKnB,KAAL,CAAWoB,IAAX,CAAgBL,IAAhB;AACA,eAAKd,WAAL,CAAiBmB,IAAjB,CAAsB,CAAtB;AACH;;AAEOD,QAAAA,UAAU,CAACJ,IAAD,EAAmB;AACjCA,UAAAA,IAAI,CAACE,WAAL,CAAiBI,GAAjB,CAAqB,KAAKF,UAA1B;AAEA,gBAAMG,KAAK,GAAG,KAAKtB,KAAL,CAAWuB,OAAX,CAAmBR,IAAnB,CAAd;AAEA,eAAKf,KAAL,CAAWwB,MAAX,CAAkBF,KAAlB,EAAyB,CAAzB;AACA,eAAKrB,WAAL,CAAiBuB,MAAjB,CAAwBF,KAAxB,EAA+B,CAA/B;AACH;;AAlCsB,O","sourcesContent":["import { Node, Vec3 } from \"cc\";\r\nimport { getDirection } from \"../../Services/Utils/VecUtils\";\r\nimport { Item } from \"./Item\";\r\n\r\nexport class ItemAttractor {\r\n    private items: Item[] = [];\r\n    private speedValues: number[] = [];\r\n\r\n    public constructor(private playerNode: Node, private speedIncreasePerSecond: number) {}\r\n\r\n    public gameTick(deltaTime: number): void {\r\n        for (let i = 0; i < this.items.length; i++) {\r\n            const direction: Vec3 = getDirection(this.playerNode.worldPosition, this.items[i].node.worldPosition);\r\n            const position = this.items[i].node.worldPosition.clone();\r\n            position.x += direction.x * this.speedValues[i] * deltaTime;\r\n            position.y += direction.y * this.speedValues[i] * deltaTime;\r\n\r\n            this.items[i].node.setWorldPosition(position);\r\n            this.speedValues[i] += this.speedIncreasePerSecond * deltaTime;\r\n        }\r\n    }\r\n\r\n    public addItem(item: Item): void {\r\n        if (this.items.includes(item)) return;\r\n\r\n        item.PickupEvent.on(this.removeItem, this);\r\n\r\n        this.items.push(item);\r\n        this.speedValues.push(0);\r\n    }\r\n\r\n    private removeItem(item: Item): void {\r\n        item.PickupEvent.off(this.removeItem);\r\n\r\n        const index = this.items.indexOf(item);\r\n\r\n        this.items.splice(index, 1);\r\n        this.speedValues.splice(index, 1);\r\n    }\r\n}\r\n"]}