{"version":3,"sources":["file:///C:/project/work/cocos/clashmonsters/assets/Scripts/Menu/ModalWindows/Upgrades/UpgradeUI.ts"],"names":["Component","instantiate","Label","Node","Prefab","Sprite","_decorator","AppRoot","Signal","UIButton","formatString","UpgradeLevelPointUI","ccclass","property","UpgradeUI","interactedEvent","upgradeType","upgradeSettings","translationData","levelPointUIs","init","level","icon","spriteFrame","Instance","GameAssets","MetaUpgradeIcons","getIcon","title","string","uiButton","InteractedEvent","on","trigger","i","bonuses","length","node","levelPointPrefab","setParent","levelPointsParent","levelPointUI","getComponent","push","updateLevel","upgrade","maxLevel","active","description","toString","cost","costs"],"mappings":"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","sourcesContent":["import { Component, instantiate, Label, Node, Prefab, Sprite, _decorator } from \"cc\";\r\nimport { AppRoot } from \"../../../AppRoot/AppRoot\";\r\nimport { MetaUpgradeSettings } from \"../../../Game/Data/GameSettings\";\r\nimport { TranslationData } from \"../../../Game/Data/TranslationData\";\r\nimport { MetaUpgradeType } from \"../../../Game/Upgrades/UpgradeType\";\r\nimport { ISignal } from \"../../../Services/EventSystem/ISignal\";\r\nimport { Signal } from \"../../../Services/EventSystem/Signal\";\r\nimport { UIButton } from \"../../../Services/UI/Button/UIButton\";\r\nimport { formatString } from \"../../../Services/Utils/StringUtils\";\r\nimport { UpgradeLevelPointUI } from \"./UpgradeLevelPointUI\";\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass(\"UpgradeUI\")\r\nexport class UpgradeUI extends Component {\r\n    @property(Prefab) private levelPointPrefab: Prefab;\r\n    @property(Node) private levelPointsParent: Node;\r\n    @property(Label) private title: Label;\r\n    @property(Label) private description: Label;\r\n    @property(Label) private cost: Label;\r\n    @property(Label) private maxLevel: Label;\r\n    @property(Sprite) private icon: Sprite;\r\n\r\n    @property(UIButton) private uiButton: UIButton;\r\n\r\n    private interactedEvent = new Signal<MetaUpgradeType>();\r\n\r\n    private upgradeType: MetaUpgradeType;\r\n    private upgradeSettings: MetaUpgradeSettings;\r\n    private translationData: TranslationData;\r\n\r\n    private levelPointUIs: UpgradeLevelPointUI[] = [];\r\n\r\n    public init(upgradeType: MetaUpgradeType, upgradeSettings: MetaUpgradeSettings, level: number, translationData: TranslationData): void {\r\n        this.upgradeType = upgradeType;\r\n        this.upgradeSettings = upgradeSettings;\r\n        this.translationData = translationData;\r\n\r\n        this.icon.spriteFrame = AppRoot.Instance.GameAssets.MetaUpgradeIcons.getIcon(upgradeType);\r\n        this.title.string = `${translationData[`${upgradeType}_TITLE`]}`;\r\n        this.uiButton.InteractedEvent.on(() => this.interactedEvent.trigger(upgradeType), this);\r\n\r\n        for (let i = 0; i < this.upgradeSettings.bonuses.length; i++) {\r\n            const node: Node = instantiate(this.levelPointPrefab);\r\n            node.setParent(this.levelPointsParent);\r\n\r\n            const levelPointUI = node.getComponent(UpgradeLevelPointUI);\r\n            levelPointUI.init();\r\n\r\n            this.levelPointUIs.push(levelPointUI);\r\n        }\r\n\r\n        this.updateLevel(level);\r\n    }\r\n\r\n    public updateLevel(level: number): void {\r\n        for (let i = 0; i < this.levelPointUIs.length; i++) {\r\n            if (i < level) {\r\n                this.levelPointUIs[i].upgrade();\r\n            }\r\n        }\r\n\r\n        if (level < this.upgradeSettings.bonuses.length) {\r\n            this.maxLevel.node.active = false;\r\n            this.description.string = formatString(`${this.translationData[`${this.upgradeType}_DESC`]}`, [\r\n                this.upgradeSettings.bonuses[level].toString()\r\n            ]);\r\n            this.cost.string = this.upgradeSettings.costs[level].toString();\r\n        } else {\r\n            // reached max level\r\n            this.maxLevel.node.active = true;\r\n            this.cost.node.active = false;\r\n            this.description.node.active = false;\r\n        }\r\n    }\r\n\r\n    public get InteractedEvent(): ISignal<MetaUpgradeType> {\r\n        return this.interactedEvent;\r\n    }\r\n}\r\n"]}