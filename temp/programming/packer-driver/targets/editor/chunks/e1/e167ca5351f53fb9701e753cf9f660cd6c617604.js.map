{"version":3,"sources":["file:///C:/project/work/cocos/clashmonsters/assets/Scripts/Game/Unit/Enemy/EnemyMover/WaveEnemyMover.ts"],"names":["WaveEnemyMover","Vec3","EnemyMover","enemyToDirection","Map","lastTargetPosition","lastDirection","addEnemy","enemy","direction","equals","targetNode","worldPosition","subtract","node","clone","set","normalize","removeEnemy","delete","gameTick","deltaTime","enemyAndDirection"],"mappings":";;;iGAIaA,c;;;;;;;;;;;;;;;;;;;AAJJC,MAAAA,I,OAAAA,I;;AAEAC,MAAAA,U,iBAAAA,U;;;;;;;;;gCAEIF,c,GAAN,MAAMA,cAAN;AAAA;AAAA,oCAAwC;AAAA;AAAA;AAAA,eACnCG,gBADmC,GACE,IAAIC,GAAJ,EADF;AAAA,eAEnCC,kBAFmC,GAER,IAAIJ,IAAJ,EAFQ;AAAA,eAGnCK,aAHmC,GAGb,IAAIL,IAAJ,EAHa;AAAA;;AAKpCM,QAAAA,QAAQ,CAACC,KAAD,EAAqB;AAChC,cAAIC,SAAe,GAAG,IAAIR,IAAJ,EAAtB,CADgC,CAGhC;;AACA,cAAIA,IAAI,CAACS,MAAL,CAAY,KAAKL,kBAAjB,EAAqC,KAAKM,UAAL,CAAgBC,aAArD,CAAJ,EAAyE;AACrEH,YAAAA,SAAS,GAAG,KAAKH,aAAjB;AACH,WAFD,MAEO;AACHG,YAAAA,SAAS,GAAGR,IAAI,CAACY,QAAL,CAAcJ,SAAd,EAAyB,KAAKE,UAAL,CAAgBC,aAAzC,EAAwDJ,KAAK,CAACM,IAAN,CAAWF,aAAnE,CAAZ;AACA,iBAAKN,aAAL,GAAqBG,SAArB;AACA,iBAAKJ,kBAAL,GAA0B,KAAKM,UAAL,CAAgBC,aAAhB,CAA8BG,KAA9B,EAA1B;AACH;;AAED,eAAKZ,gBAAL,CAAsBa,GAAtB,CAA0BR,KAA1B,EAAiCC,SAAS,CAACQ,SAAV,EAAjC;AACA,gBAAMV,QAAN,CAAeC,KAAf;AACH;;AAEMU,QAAAA,WAAW,CAACV,KAAD,EAAqB;AACnC,eAAKL,gBAAL,CAAsBgB,MAAtB,CAA6BX,KAA7B;AACA,gBAAMU,WAAN,CAAkBV,KAAlB;AACH;;AAEMY,QAAAA,QAAQ,CAACC,SAAD,EAA0B;AACrC,eAAK,MAAMC,iBAAX,IAAgC,KAAKnB,gBAArC,EAAuD;AACnDmB,YAAAA,iBAAiB,CAAC,CAAD,CAAjB,CAAqBF,QAArB,CAA8BE,iBAAiB,CAAC,CAAD,CAA/C,EAAoDD,SAApD;AACH;AACJ;;AA9B0C,O","sourcesContent":["import { Vec3 } from \"cc\";\r\nimport { Enemy } from \"../Enemy\";\r\nimport { EnemyMover } from \"./EnemyMover\";\r\n\r\nexport class WaveEnemyMover extends EnemyMover {\r\n    private enemyToDirection: Map<Enemy, Vec3> = new Map<Enemy, Vec3>();\r\n    private lastTargetPosition: Vec3 = new Vec3();\r\n    private lastDirection: Vec3 = new Vec3();\r\n\r\n    public addEnemy(enemy: Enemy): void {\r\n        let direction: Vec3 = new Vec3();\r\n\r\n        // if the enemy is added soon enough, move as a single group towards one direction\r\n        if (Vec3.equals(this.lastTargetPosition, this.targetNode.worldPosition)) {\r\n            direction = this.lastDirection;\r\n        } else {\r\n            direction = Vec3.subtract(direction, this.targetNode.worldPosition, enemy.node.worldPosition);\r\n            this.lastDirection = direction;\r\n            this.lastTargetPosition = this.targetNode.worldPosition.clone();\r\n        }\r\n\r\n        this.enemyToDirection.set(enemy, direction.normalize());\r\n        super.addEnemy(enemy);\r\n    }\r\n\r\n    public removeEnemy(enemy: Enemy): void {\r\n        this.enemyToDirection.delete(enemy);\r\n        super.removeEnemy(enemy);\r\n    }\r\n\r\n    public gameTick(deltaTime: number): void {\r\n        for (const enemyAndDirection of this.enemyToDirection) {\r\n            enemyAndDirection[0].gameTick(enemyAndDirection[1], deltaTime);\r\n        }\r\n    }\r\n}\r\n"]}