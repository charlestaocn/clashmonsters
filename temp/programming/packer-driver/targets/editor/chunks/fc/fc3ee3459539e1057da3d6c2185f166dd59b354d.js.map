{"version":3,"sources":["file:///C:/project/work/cocos/clashmonsters/assets/Scripts/Game/Input/VirtualJoystic.ts"],"names":["_decorator","Component","Node","Vec3","input","Input","Vec2","CCFloat","ccclass","property","VirtualJoystic","init","on","EventType","MOUSE_DOWN","activateMouseJoystic","MOUSE_UP","deactivateJoystic","MOUSE_MOVE","moveKnobMouse","TOUCH_START","activateTouchJoystic","TOUCH_END","TOUCH_MOVE","moveKnobTouch","getAxis","knob","position","x","maxDistance","y","e","activateJoystic","getUILocation","console","log","location","node","active","setPosition","moveKnob","posDelta","subtract","length","Math","sqrt","multiplier"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Vec3, input, Input, EventMouse, Vec2, EventTouch, CCFloat } from \"cc\";\r\nimport { IInput } from \"./IInput\";\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass(\"VirtualJoystic\")\r\nexport class VirtualJoystic extends Component implements IInput {\r\n    @property(CCFloat) private maxDistance = 10;\r\n    @property(Node) private knob: Node;\r\n\r\n    #isUsingJoystic = false;\r\n    #defaultPosition: Vec2 = new Vec2();\r\n\r\n    public init(): void {\r\n        input.on(Input.EventType.MOUSE_DOWN, this.activateMouseJoystic, this);\r\n        input.on(Input.EventType.MOUSE_UP, this.deactivateJoystic, this);\r\n        input.on(Input.EventType.MOUSE_MOVE, this.moveKnobMouse, this);\r\n\r\n        input.on(Input.EventType.TOUCH_START, this.activateTouchJoystic, this);\r\n        input.on(Input.EventType.TOUCH_END, this.deactivateJoystic, this);\r\n        input.on(Input.EventType.TOUCH_MOVE, this.moveKnobTouch, this);\r\n\r\n        this.deactivateJoystic();\r\n    }\r\n\r\n    public getAxis(): Vec2 {\r\n        if (this.#isUsingJoystic) {\r\n            return new Vec2(this.knob.position.x / this.maxDistance, this.knob.position.y / this.maxDistance);\r\n        } else {\r\n            return new Vec2();\r\n        }\r\n    }\r\n\r\n    private activateTouchJoystic(e: EventTouch): void {\r\n        this.activateJoystic(e.getUILocation());\r\n    }\r\n\r\n    private activateMouseJoystic(e: EventMouse): void {\r\n        console.log(e.getUILocation());\r\n        this.activateJoystic(e.getUILocation());\r\n    }\r\n\r\n    private activateJoystic(location: Vec2): void {\r\n        this.#isUsingJoystic = true;\r\n        this.node.active = true;\r\n        this.#defaultPosition = location;\r\n\r\n        this.node.setPosition(new Vec3(this.#defaultPosition.x, this.#defaultPosition.y, 0));\r\n        this.knob.position = new Vec3();\r\n    }\r\n\r\n    private deactivateJoystic(): void {\r\n        this.#isUsingJoystic = false;\r\n        this.node.active = false;\r\n    }\r\n\r\n    private moveKnobTouch(e: EventTouch): void {\r\n        this.moveKnob(e.getUILocation());\r\n    }\r\n\r\n    private moveKnobMouse(e: EventMouse): void {\r\n        this.moveKnob(e.getUILocation());\r\n    }\r\n\r\n    private moveKnob(location: Vec2): void {\r\n        if (!this.#isUsingJoystic) return;\r\n\r\n        const posDelta: Vec2 = location.subtract(this.#defaultPosition);\r\n        let x: number = posDelta.x;\r\n        let y: number = posDelta.y;\r\n\r\n        const length: number = Math.sqrt(posDelta.x ** 2 + posDelta.y ** 2);\r\n        if (this.maxDistance < length) {\r\n            const multiplier: number = this.maxDistance / length;\r\n\r\n            x *= multiplier;\r\n            y *= multiplier;\r\n        }\r\n\r\n        this.knob.position = new Vec3(x, y, 0);\r\n    }\r\n}\r\n"]}