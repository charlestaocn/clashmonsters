{"version":3,"sources":["file:///C:/project/work/cocos/clashmonsters/assets/Scripts/AppRoot/AppRoot.ts"],"names":["Camera","Component","director","instantiate","JsonAsset","Prefab","_decorator","GameAssets","AudioPlayer","SaveSystem","ModalWindowManager","OpenCloseAnimator","ccclass","property","AppRoot","saveSystem","liveUserData","gameAssets","Instance","instance","audio","LiveUserData","Settings","settingsAsset","json","TranslationData","engTranslationAsset","modalWindowManager","MainCamera","mainCamera","ScreenFader","screenFader","saveUserData","save","start","addPersistRootNode","node","init","destroy","update","deltaTime","load","gameAssetsNode","gameAssetsPrefab","setParent","getComponent","soundVolume","musicVolume","active"],"mappings":"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","sourcesContent":["import { Camera, Component, director, instantiate, JsonAsset, Prefab, _decorator } from \"cc\";\r\nimport { GameSettings } from \"../Game/Data/GameSettings\";\r\nimport { GameAssets } from \"../Game/Data/Assets/GameAssets\";\r\nimport { TranslationData } from \"../Game/Data/TranslationData\";\r\nimport { UserData } from \"../Game/Data/UserData\";\r\nimport { AudioPlayer } from \"../Services/AudioPlayer/AudioPlayer\";\r\nimport { SaveSystem } from \"./SaveSystem\";\r\nimport { ModalWindowManager } from \"../Services/ModalWindowSystem/ModalWindowManager\";\r\nimport { OpenCloseAnimator } from \"../Utils/OpenCloseAnimator\";\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass(\"AppRoot\")\r\nexport class AppRoot extends Component {\r\n    @property(AudioPlayer) private audio: AudioPlayer;\r\n    @property(JsonAsset) private settingsAsset: JsonAsset;\r\n    @property(JsonAsset) private engTranslationAsset: JsonAsset;\r\n    @property(Prefab) private gameAssetsPrefab: Prefab;\r\n    @property(Camera) private mainCamera: Camera;\r\n    @property(ModalWindowManager) private modalWindowManager: ModalWindowManager;\r\n    @property(OpenCloseAnimator) private screenFader: OpenCloseAnimator;\r\n\r\n    private static instance: AppRoot;\r\n    private saveSystem: SaveSystem;\r\n\r\n    private liveUserData: UserData;\r\n    private gameAssets: GameAssets;\r\n\r\n    public static get Instance(): AppRoot {\r\n        return this.instance;\r\n    }\r\n\r\n    public get AudioPlayer(): AudioPlayer {\r\n        return this.audio;\r\n    }\r\n\r\n    public get GameAssets(): GameAssets {\r\n        return this.gameAssets;\r\n    }\r\n\r\n    public get LiveUserData(): UserData {\r\n        return this.liveUserData;\r\n    }\r\n\r\n    public get Settings(): GameSettings {\r\n        return <GameSettings>this.settingsAsset.json;\r\n    }\r\n\r\n    public get TranslationData(): TranslationData {\r\n        return <TranslationData>this.engTranslationAsset.json;\r\n    }\r\n\r\n    public get ModalWindowManager(): ModalWindowManager {\r\n        return this.modalWindowManager;\r\n    }\r\n\r\n    public get MainCamera(): Camera {\r\n        return this.mainCamera;\r\n    }\r\n\r\n    public get ScreenFader(): OpenCloseAnimator {\r\n        return this.screenFader;\r\n    }\r\n\r\n \r\n\r\n    public saveUserData(): void {\r\n        this.saveSystem.save(this.liveUserData);\r\n    }\r\n\r\n    public start(): void {\r\n        if (AppRoot.Instance == null) {\r\n            AppRoot.instance = this;\r\n            director.addPersistRootNode(this.node);\r\n            this.init();\r\n        } else {\r\n            this.node.destroy();\r\n        }\r\n    }\r\n\r\n    public update(deltaTime: number): void {\r\n       \r\n    }\r\n\r\n    private async init(): Promise<void> {\r\n        this.saveSystem = new SaveSystem();\r\n        this.liveUserData = this.saveSystem.load();\r\n\r\n        const gameAssetsNode = instantiate(this.gameAssetsPrefab);\r\n        gameAssetsNode.setParent(this.node);\r\n        this.gameAssets = gameAssetsNode.getComponent(GameAssets);\r\n        this.gameAssets.init();\r\n\r\n        this.audio.init(this.LiveUserData.soundVolume, this.LiveUserData.musicVolume);\r\n\r\n        this.screenFader.init();\r\n        this.screenFader.node.active = false;\r\n    }\r\n}\r\n"]}