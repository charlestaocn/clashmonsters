{"version":3,"sources":["file:///C:/project/work/cocos/clashmonsters/assets/Scripts/Game/Projectile/Projectile.ts"],"names":["Collider2D","Component","Contact2DType","Vec3","_decorator","Signal","ccclass","property","Projectile","contactBeginEvent","piercesDepletedEvent","isContactListenerSet","piercesLeft","damage","setup","pierces","angle","collider","on","BEGIN_CONTACT","onColliderContactBegin","node","setRotationFromEuler","pierce","trigger","Damage","ContactBeginEvent","PiercesDepletedEvent","thisCollider","otherCollider","projectile"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,a,OAAAA,a;AAAeC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,U,OAAAA,U;;AAE5CC,MAAAA,M,iBAAAA,M;;;;;;;;;OAEH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBH,U;;4BAGjBI,U,WADZF,OAAO,CAAC,YAAD,C,UAEHC,QAAQ,CAACP,UAAD,C,2BAFb,MACaQ,UADb,SACgCP,SADhC,CAC0C;AAAA;AAAA;;AAAA;;AAAA,eAE9BQ,iBAF8B,GAEV;AAAA;AAAA,iCAFU;AAAA,eAG9BC,oBAH8B,GAGP;AAAA;AAAA,iCAHO;AAAA,eAK9BC,oBAL8B,GAKP,KALO;AAAA,eAO9BC,WAP8B,GAOhB,CAPgB;AAAA,eAQ9BC,MAR8B,GAQrB,CARqB;AAAA;;AAU/BC,QAAAA,KAAK,CAACD,MAAD,EAAiBE,OAAjB,EAAkCC,KAAlC,EAAuD;AAC/D,eAAKJ,WAAL,GAAmBG,OAAnB;AACA,eAAKF,MAAL,GAAcA,MAAd;;AAEA,cAAI,CAAC,KAAKF,oBAAV,EAAgC;AAC5B,iBAAKA,oBAAL,GAA4B,IAA5B;AACA,iBAAKM,QAAL,CAAcC,EAAd,CAAiBhB,aAAa,CAACiB,aAA/B,EAA8C,KAAKC,sBAAnD,EAA2E,IAA3E;AACH;;AAED,eAAKC,IAAL,CAAUC,oBAAV,CAA+B,IAAInB,IAAJ,CAAS,CAAT,EAAY,CAAZ,EAAea,KAAf,CAA/B;AACH;;AAEMO,QAAAA,MAAM,GAAS;AAClB,eAAKX,WAAL;;AACA,cAAI,KAAKA,WAAL,IAAoB,CAAxB,EAA2B;AACvB,iBAAKF,oBAAL,CAA0Bc,OAA1B,CAAkC,IAAlC;AACH;AACJ;;AAEgB,YAANC,MAAM,GAAW;AACxB,iBAAO,KAAKZ,MAAZ;AACH;;AAE2B,YAAjBa,iBAAiB,GAAiC;AACzD,iBAAO,KAAKjB,iBAAZ;AACH;;AAE8B,YAApBkB,oBAAoB,GAAwB;AACnD,iBAAO,KAAKjB,oBAAZ;AACH;;AAEOU,QAAAA,sBAAsB,CAACQ,YAAD,EAA2BC,aAA3B,EAA4D;AACtF,eAAKpB,iBAAL,CAAuBe,OAAvB,CAA+B;AAAEK,YAAAA,aAAF;AAAiBC,YAAAA,UAAU,EAAE;AAA7B,WAA/B;AACH;;AA3CqC,O","sourcesContent":["import { Collider2D, Component, Contact2DType, Vec3, _decorator } from \"cc\";\r\nimport { ISignal } from \"../../Services/EventSystem/ISignal\";\r\nimport { Signal } from \"../../Services/EventSystem/Signal\";\r\nimport { ProjectileCollision } from \"./ProjectileCollision\";\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass(\"Projectile\")\r\nexport class Projectile extends Component {\r\n    @property(Collider2D) private collider: Collider2D;\r\n    private contactBeginEvent = new Signal<ProjectileCollision>();\r\n    private piercesDepletedEvent = new Signal<Projectile>();\r\n\r\n    private isContactListenerSet = false;\r\n\r\n    private piercesLeft = 0;\r\n    private damage = 0;\r\n\r\n    public setup(damage: number, pierces: number, angle: number): void {\r\n        this.piercesLeft = pierces;\r\n        this.damage = damage;\r\n\r\n        if (!this.isContactListenerSet) {\r\n            this.isContactListenerSet = true;\r\n            this.collider.on(Contact2DType.BEGIN_CONTACT, this.onColliderContactBegin, this);\r\n        }\r\n\r\n        this.node.setRotationFromEuler(new Vec3(0, 0, angle));\r\n    }\r\n\r\n    public pierce(): void {\r\n        this.piercesLeft--;\r\n        if (this.piercesLeft <= 0) {\r\n            this.piercesDepletedEvent.trigger(this);\r\n        }\r\n    }\r\n\r\n    public get Damage(): number {\r\n        return this.damage;\r\n    }\r\n\r\n    public get ContactBeginEvent(): ISignal<ProjectileCollision> {\r\n        return this.contactBeginEvent;\r\n    }\r\n\r\n    public get PiercesDepletedEvent(): ISignal<Projectile> {\r\n        return this.piercesDepletedEvent;\r\n    }\r\n\r\n    private onColliderContactBegin(thisCollider: Collider2D, otherCollider: Collider2D): void {\r\n        this.contactBeginEvent.trigger({ otherCollider, projectile: this });\r\n    }\r\n}\r\n"]}