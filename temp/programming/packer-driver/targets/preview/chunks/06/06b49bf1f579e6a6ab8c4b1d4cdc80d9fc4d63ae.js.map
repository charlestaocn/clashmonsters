{"version":3,"sources":["file:///C:/project/work/cocos/clashmonsters/assets/Scripts/Game/Unit/Player/Weapon/Weapon.ts"],"names":["Animation","Component","_decorator","Signal","GameTimer","UpgradableCollider","ccclass","property","Weapon","weaponStrikeEvent","strikeTimer","strikeState","damage","init","strikeDelay","node","active","weaponAnimation","on","EventType","FINISHED","endStrike","getState","clips","name","speed","upgradableCollider","gameTick","deltaTime","tryFinishPeriod","strike","WeaponStrikeEvent","Collider","Damage","upgradeWeaponDamage","upgradeWeaponLength","upgrade","play","trigger"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,S,OAAAA,S;AAA2BC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,U,OAAAA,U;;AAEtCC,MAAAA,M,iBAAAA,M;;AACAC,MAAAA,S,iBAAAA,S;;AAEAC,MAAAA,kB,iBAAAA,kB;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBL,U;;wBAGjBM,M,WADZF,OAAO,CAAC,QAAD,C,UAEHC,QAAQ,CAACP,SAAD,C,UACRO,QAAQ;AAAA;AAAA,mD,2BAHb,MACaC,MADb,SAC4BP,SAD5B,CACsC;AAAA;AAAA;;AAAA;;AAAA;;AAAA,eAI1BQ,iBAJ0B,GAIN;AAAA;AAAA,iCAJM;AAAA,eAM1BC,WAN0B;AAAA,eAO1BC,WAP0B;AAAA,eAQ1BC,MAR0B;AAAA;;AAU3BC,QAAAA,IAAI,CAACC,WAAD,EAAsBF,MAAtB,EAA4C;AACnD,eAAKF,WAAL,GAAmB;AAAA;AAAA,sCAAcI,WAAd,CAAnB;AACA,eAAKF,MAAL,GAAcA,MAAd;AACA,eAAKG,IAAL,CAAUC,MAAV,GAAmB,KAAnB;AAEA,eAAKC,eAAL,CAAqBC,EAArB,CAAwBlB,SAAS,CAACmB,SAAV,CAAoBC,QAA5C,EAAsD,KAAKC,SAA3D,EAAsE,IAAtE;AACA,eAAKV,WAAL,GAAmB,KAAKM,eAAL,CAAqBK,QAArB,CAA8B,KAAKL,eAAL,CAAqBM,KAArB,CAA2B,CAA3B,EAA8BC,IAA5D,CAAnB;AACA,eAAKb,WAAL,CAAiBc,KAAjB,GAAyB,CAAzB;AAEA,eAAKC,kBAAL,CAAwBb,IAAxB;AACH;;AAEMc,QAAAA,QAAQ,CAACC,SAAD,EAA0B;AACrC,eAAKlB,WAAL,CAAiBiB,QAAjB,CAA0BC,SAA1B;;AACA,cAAI,KAAKlB,WAAL,CAAiBmB,eAAjB,EAAJ,EAAwC;AACpC,iBAAKC,MAAL;AACH;AACJ;;AAE2B,YAAjBC,iBAAiB,GAAoB;AAC5C,iBAAO,KAAKtB,iBAAZ;AACH;;AAEkB,YAARuB,QAAQ,GAAuB;AACtC,iBAAO,KAAKN,kBAAZ;AACH;;AAEgB,YAANO,MAAM,GAAW;AACxB,iBAAO,KAAKrB,MAAZ;AACH;;AAEMsB,QAAAA,mBAAmB,GAAS;AAC/B,eAAKtB,MAAL;AACH;;AACMuB,QAAAA,mBAAmB,GAAS;AAC/B,eAAKT,kBAAL,CAAwBU,OAAxB;AACH;;AAEON,QAAAA,MAAM,GAAS;AACnB,eAAKf,IAAL,CAAUC,MAAV,GAAmB,IAAnB;AACA,eAAKC,eAAL,CAAqBoB,IAArB,CAA0B,KAAK1B,WAAL,CAAiBa,IAA3C;AACA,eAAKf,iBAAL,CAAuB6B,OAAvB,CAA+B,IAA/B;AACH;;AAEOjB,QAAAA,SAAS,GAAS;AACtB,eAAKN,IAAL,CAAUC,MAAV,GAAmB,KAAnB;AACH;;AAxDiC,O","sourcesContent":["import { Animation, AnimationState, Component, _decorator } from \"cc\";\r\nimport { ISignal } from \"../../../../Services/EventSystem/ISignal\";\r\nimport { Signal } from \"../../../../Services/EventSystem/Signal\";\r\nimport { GameTimer } from \"../../../../Services/GameTimer\";\r\n\r\nimport { UpgradableCollider } from \"./UpgradableCollider\";\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass(\"Weapon\")\r\nexport class Weapon extends Component {\r\n    @property(Animation) private weaponAnimation: Animation;\r\n    @property(UpgradableCollider) private upgradableCollider: UpgradableCollider;\r\n\r\n    private weaponStrikeEvent = new Signal<Weapon>();\r\n\r\n    private strikeTimer: GameTimer;\r\n    private strikeState: AnimationState;\r\n    private damage: number;\r\n\r\n    public init(strikeDelay: number, damage: number): void {\r\n        this.strikeTimer = new GameTimer(strikeDelay);\r\n        this.damage = damage;\r\n        this.node.active = false;\r\n\r\n        this.weaponAnimation.on(Animation.EventType.FINISHED, this.endStrike, this);\r\n        this.strikeState = this.weaponAnimation.getState(this.weaponAnimation.clips[0].name);\r\n        this.strikeState.speed = 1;\r\n\r\n        this.upgradableCollider.init();\r\n    }\r\n\r\n    public gameTick(deltaTime: number): void {\r\n        this.strikeTimer.gameTick(deltaTime);\r\n        if (this.strikeTimer.tryFinishPeriod()) {\r\n            this.strike();\r\n        }\r\n    }\r\n\r\n    public get WeaponStrikeEvent(): ISignal<Weapon> {\r\n        return this.weaponStrikeEvent;\r\n    }\r\n\r\n    public get Collider(): UpgradableCollider {\r\n        return this.upgradableCollider;\r\n    }\r\n\r\n    public get Damage(): number {\r\n        return this.damage;\r\n    }\r\n\r\n    public upgradeWeaponDamage(): void {\r\n        this.damage++;\r\n    }\r\n    public upgradeWeaponLength(): void {\r\n        this.upgradableCollider.upgrade();\r\n    }\r\n\r\n    private strike(): void {\r\n        this.node.active = true;\r\n        this.weaponAnimation.play(this.strikeState.name);\r\n        this.weaponStrikeEvent.trigger(this);\r\n    }\r\n\r\n    private endStrike(): void {\r\n        this.node.active = false;\r\n    }\r\n}\r\n"]}