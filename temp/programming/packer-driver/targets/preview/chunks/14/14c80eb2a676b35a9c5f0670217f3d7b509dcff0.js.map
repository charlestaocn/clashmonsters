{"version":3,"sources":["file:///C:/project/work/cocos/clashmonsters/assets/Scripts/Game/Unit/Enemy/EnemyDeathEffectSpawner/EnemyDeathEffectSpawner.ts"],"names":["_decorator","Component","Prefab","ObjectPool","delay","ccclass","property","EnemyDeathEffectSpawner","effectPool","init","enemyManager","EnemyAddedEvent","on","onEnemyAdded","EnemyRemovedEvent","onEnemyRemoved","deathEffectPrefab","node","enemy","DeathEvent","animateDeathEffect","off","deathEffect","borrow","setup","worldPosition","return"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAiBC,MAAAA,M,OAAAA,M;;AAE7BC,MAAAA,U,iBAAAA,U;;AACAC,MAAAA,K,iBAAAA,K;;;;;;;;;OAIH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBN,U;;yCAGjBO,uB,WADZF,OAAO,CAAC,yBAAD,C,UAEHC,QAAQ,CAACJ,MAAD,C,2BAFb,MACaK,uBADb,SAC6CN,SAD7C,CACuD;AAAA;AAAA;;AAAA;;AAAA,eAG3CO,UAH2C;AAAA;;AAK5CC,QAAAA,IAAI,CAACC,YAAD,EAAmC;AAC1CA,UAAAA,YAAY,CAACC,eAAb,CAA6BC,EAA7B,CAAgC,KAAKC,YAArC,EAAmD,IAAnD;AACAH,UAAAA,YAAY,CAACI,iBAAb,CAA+BF,EAA/B,CAAkC,KAAKG,cAAvC,EAAuD,IAAvD;AAEA,eAAKP,UAAL,GAAkB;AAAA;AAAA,wCAAe,KAAKQ,iBAApB,EAAuC,KAAKC,IAA5C,EAAkD,CAAlD,EAAqD,kBAArD,CAAlB;AACH;;AAEOJ,QAAAA,YAAY,CAACK,KAAD,EAAqB;AACrCA,UAAAA,KAAK,CAACC,UAAN,CAAiBP,EAAjB,CAAoB,KAAKQ,kBAAzB,EAA6C,IAA7C;AACH;;AAEOL,QAAAA,cAAc,CAACG,KAAD,EAAqB;AACvCA,UAAAA,KAAK,CAACC,UAAN,CAAiBE,GAAjB,CAAqB,KAAKD,kBAA1B;AACH;;AAEaA,QAAAA,kBAAkB,CAACF,KAAD,EAA8B;AAAA;;AAAA;AAC1D,gBAAMI,WAAW,GAAG,KAAI,CAACd,UAAL,CAAgBe,MAAhB,EAApB;;AACAD,YAAAA,WAAW,CAACE,KAAZ,CAAkBN,KAAK,CAACD,IAAN,CAAWQ,aAA7B;AAEA,kBAAM;AAAA;AAAA,gCAAM,GAAN,CAAN;;AAEA,YAAA,KAAI,CAACjB,UAAL,CAAgBkB,MAAhB,CAAuBJ,WAAvB;AAN0D;AAO7D;;AA3BkD,O","sourcesContent":["import { _decorator, Component, Node, Prefab } from \"cc\";\r\n\r\nimport { ObjectPool } from \"../../../../Services/ObjectPool\";\r\nimport { delay } from \"../../../../Services/Utils/AsyncUtils\";\r\nimport { Enemy } from \"../Enemy\";\r\nimport { EnemyManager } from \"../EnemyManager\";\r\nimport { EnemyDeathEffect } from \"./EnemyDeathEffect\";\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass(\"EnemyDeathEffectSpawner\")\r\nexport class EnemyDeathEffectSpawner extends Component {\r\n    @property(Prefab) private deathEffectPrefab: Prefab;\r\n\r\n    private effectPool: ObjectPool<EnemyDeathEffect>;\r\n\r\n    public init(enemyManager: EnemyManager): void {\r\n        enemyManager.EnemyAddedEvent.on(this.onEnemyAdded, this);\r\n        enemyManager.EnemyRemovedEvent.on(this.onEnemyRemoved, this);\r\n\r\n        this.effectPool = new ObjectPool(this.deathEffectPrefab, this.node, 5, \"EnemyDeathEffect\");\r\n    }\r\n\r\n    private onEnemyAdded(enemy: Enemy): void {\r\n        enemy.DeathEvent.on(this.animateDeathEffect, this);\r\n    }\r\n\r\n    private onEnemyRemoved(enemy: Enemy): void {\r\n        enemy.DeathEvent.off(this.animateDeathEffect);\r\n    }\r\n\r\n    private async animateDeathEffect(enemy: Enemy): Promise<void> {\r\n        const deathEffect = this.effectPool.borrow();\r\n        deathEffect.setup(enemy.node.worldPosition);\r\n\r\n        await delay(360);\r\n\r\n        this.effectPool.return(deathEffect);\r\n    }\r\n}\r\n"]}