{"version":3,"sources":["file:///C:/project/work/cocos/clashmonsters/assets/Scripts/Game/Unit/Enemy/EnemySpawner/WaveEnemySpawner.ts"],"names":["WaveEnemySpawner","randomRange","GameTimer","randomPositiveOrNegative","DelayedEnemySpawner","constructor","enemySpawner","settings","common","startDelay","stopDelay","enemiesPerWave","enemyId","spawnTimer","cooldown","enemiesToSpawn","delayedGameTick","deltaTime","gameTick","tryFinishPeriod","defaultPosX","defaultPosY","enemies","side","Math","ceil","sqrt","i","randomOffsetX","randomOffsetY","posX","posY","floor","enemy","spawnNewEnemy","push"],"mappings":";;;sJAQaA,gB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AARJC,MAAAA,W,OAAAA,W;;AACAC,MAAAA,S,iBAAAA,S;;AACAC,MAAAA,wB,iBAAAA,wB;;AAGAC,MAAAA,mB,iBAAAA,mB;;;;;;;;;kCAGIJ,gB,GAAN,MAAMA,gBAAN;AAAA;AAAA,sDAAmD;AAM/CK,QAAAA,WAAW,CAASC,YAAT,EAAqCC,QAArC,EAAyE;AACvF,gBAAMA,QAAQ,CAACC,MAAT,CAAgBC,UAAtB,EAAkCF,QAAQ,CAACC,MAAT,CAAgBE,SAAlD;AADuF,eALnFC,cAKmF;AAAA,eAJnFC,OAImF;AAAA,eAFnFC,UAEmF;AAAA,eAAhEP,YAAgE,GAAhEA,YAAgE;AAGvF,eAAKO,UAAL,GAAkB;AAAA;AAAA,sCAAcN,QAAQ,CAACC,MAAT,CAAgBM,QAA9B,CAAlB;AACA,eAAKH,cAAL,GAAsBJ,QAAQ,CAACQ,cAA/B;AACA,eAAKH,OAAL,GAAeL,QAAQ,CAACC,MAAT,CAAgBI,OAA/B;AACH;;AAEMI,QAAAA,eAAe,CAACC,SAAD,EAA0B;AAC5C,eAAKJ,UAAL,CAAgBK,QAAhB,CAAyBD,SAAzB;;AACA,cAAI,KAAKJ,UAAL,CAAgBM,eAAhB,EAAJ,EAAuC;AACnC,gBAAMC,WAAmB,GAAG,CAAC,MAAMnB,WAAW,CAAC,CAAD,EAAI,GAAJ,CAAlB,IAA8B;AAAA;AAAA,uEAA1D;AACA,gBAAMoB,WAAmB,GAAGpB,WAAW,CAAC,CAAD,EAAI,GAAJ,CAAX,GAAsB;AAAA;AAAA,uEAAlD;AAEA,gBAAMqB,OAAgB,GAAG,EAAzB;AACA,gBAAMC,IAAY,GAAGC,IAAI,CAACC,IAAL,CAAUD,IAAI,CAACE,IAAL,CAAU,KAAKf,cAAf,CAAV,CAArB;;AACA,iBAAK,IAAIgB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKhB,cAAzB,EAAyCgB,CAAC,EAA1C,EAA8C;AAC1C,kBAAMC,aAAqB,GAAG3B,WAAW,CAAC,CAAC,EAAF,EAAM,EAAN,CAAzC;AACA,kBAAM4B,aAAqB,GAAG5B,WAAW,CAAC,CAAC,EAAF,EAAM,EAAN,CAAzC;AACA,kBAAM6B,IAAY,GAAGV,WAAW,GAAGQ,aAAd,GAA8B,MAAMD,CAAC,GAAGJ,IAAV,CAAnD;AACA,kBAAMQ,IAAY,GAAGV,WAAW,GAAGQ,aAAd,GAA8B,KAAKL,IAAI,CAACQ,KAAL,CAAWL,CAAC,GAAGJ,IAAf,CAAxD;AACA,kBAAMU,KAAK,GAAG,KAAK3B,YAAL,CAAkB4B,aAAlB,CAAgCJ,IAAhC,EAAsCC,IAAtC,EAA4C,KAAKnB,OAAjD,CAAd;AACAU,cAAAA,OAAO,CAACa,IAAR,CAAaF,KAAb;AACH;AACJ;AACJ;;AA/BqD,O","sourcesContent":["import { randomRange } from \"cc\";\r\nimport { GameTimer } from \"../../../../Services/GameTimer\";\r\nimport { randomPositiveOrNegative } from \"../../../../Services/Utils/MathUtils\";\r\nimport { WaveEnemySpawnerSettings } from \"../../../Data/GameSettings\";\r\nimport { Enemy } from \"../Enemy\";\r\nimport { DelayedEnemySpawner } from \"./DelayedEnemySpawner\";\r\nimport { EnemySpawner } from \"./EnemySpawner\";\r\n\r\nexport class WaveEnemySpawner extends DelayedEnemySpawner {\r\n    private enemiesPerWave: number;\r\n    private enemyId: string;\r\n\r\n    private spawnTimer: GameTimer;\r\n\r\n    public constructor(private enemySpawner: EnemySpawner, settings: WaveEnemySpawnerSettings) {\r\n        super(settings.common.startDelay, settings.common.stopDelay);\r\n\r\n        this.spawnTimer = new GameTimer(settings.common.cooldown);\r\n        this.enemiesPerWave = settings.enemiesToSpawn;\r\n        this.enemyId = settings.common.enemyId;\r\n    }\r\n\r\n    public delayedGameTick(deltaTime: number): void {\r\n        this.spawnTimer.gameTick(deltaTime);\r\n        if (this.spawnTimer.tryFinishPeriod()) {\r\n            const defaultPosX: number = (500 + randomRange(0, 100)) * randomPositiveOrNegative();\r\n            const defaultPosY: number = randomRange(0, 500) * randomPositiveOrNegative();\r\n\r\n            const enemies: Enemy[] = [];\r\n            const side: number = Math.ceil(Math.sqrt(this.enemiesPerWave));\r\n            for (let i = 0; i < this.enemiesPerWave; i++) {\r\n                const randomOffsetX: number = randomRange(-20, 20);\r\n                const randomOffsetY: number = randomRange(-20, 20);\r\n                const posX: number = defaultPosX + randomOffsetX + 50 * (i % side);\r\n                const posY: number = defaultPosY + randomOffsetY + 50 * Math.floor(i / side);\r\n                const enemy = this.enemySpawner.spawnNewEnemy(posX, posY, this.enemyId);\r\n                enemies.push(enemy);\r\n            }\r\n        }\r\n    }\r\n}\r\n"]}