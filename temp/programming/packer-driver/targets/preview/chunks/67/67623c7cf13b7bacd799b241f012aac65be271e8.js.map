{"version":3,"sources":["file:///C:/project/work/cocos/clashmonsters/assets/Scripts/Services/ObjectPool.ts"],"names":["ObjectPool","PooledObject","instantiate","constructor","prefab","parent","defaultPoolCount","componentName","pooledObjects","i","createNew","borrow","objectToBorrow","find","o","IsBorrowed","return","object","objectToReturn","Equals","Error","name","newPooledObject","push","defaultParent","isBorrowed","instancedNode","instancedComponent","getComponent","console","error","clear","component","active"],"mappings":"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","sourcesContent":["import { Component, instantiate, Node, Prefab } from \"cc\";\r\n\r\nexport class ObjectPool<T extends Component> {\r\n    private prefab: Prefab;\r\n    private parent: Node;\r\n    private pooledObjects: PooledObject<T>[] = [];\r\n    private componentName: string;\r\n\r\n    public constructor(prefab: Prefab, parent: Node, defaultPoolCount: number, componentName: string) {\r\n        this.prefab = prefab;\r\n        this.parent = parent;\r\n        this.componentName = componentName;\r\n\r\n        for (let i = 0; i < defaultPoolCount; i++) {\r\n            this.createNew();\r\n        }\r\n    }\r\n\r\n    public borrow(): T {\r\n        const objectToBorrow: PooledObject<T> | null = this.pooledObjects.find((o) => !o.IsBorrowed);\r\n        if (objectToBorrow != null) {\r\n            return objectToBorrow.borrow();\r\n        }\r\n\r\n        return this.createNew().borrow();\r\n    }\r\n\r\n    public return(object: T): void {\r\n        const objectToReturn: PooledObject<T> | null = this.pooledObjects.find((o) => o.Equals(object));\r\n        if (objectToReturn == null) {\r\n            throw new Error(\"Object \" + this.prefab.name + \" is not a member of the pool\");\r\n        }\r\n\r\n        objectToReturn.return();\r\n    }\r\n\r\n    private createNew(): PooledObject<T> {\r\n        const newPooledObject: PooledObject<T> = new PooledObject(this.prefab, this.parent, this.componentName);\r\n        this.pooledObjects.push(newPooledObject);\r\n\r\n        return newPooledObject;\r\n    }\r\n}\r\n\r\nclass PooledObject<T extends Component> {\r\n    private isBorrowed = false;\r\n    private defaultParent: Node;\r\n    private instancedNode: Node;\r\n    private instancedComponent: T;\r\n\r\n    public constructor(prefab: Prefab, defaultParent: Node, componentName: string) {\r\n        this.defaultParent = defaultParent;\r\n\r\n        this.instancedNode = instantiate(prefab);\r\n        this.instancedComponent = <T>this.instancedNode.getComponent(componentName);\r\n        if (this.instancedComponent == null) {\r\n            console.error(\"Object \" + prefab.name + \" does not have component \" + componentName);\r\n        }\r\n\r\n        this.clear();\r\n    }\r\n\r\n    public get IsBorrowed(): boolean {\r\n        return this.isBorrowed;\r\n    }\r\n\r\n    public Equals(component: T): boolean {\r\n        return this.instancedComponent == component;\r\n    }\r\n\r\n    public borrow(): T {\r\n        this.isBorrowed = true;\r\n        return this.instancedComponent;\r\n    }\r\n\r\n    public return(): void {\r\n        this.clear();\r\n    }\r\n\r\n    private clear(): void {\r\n        this.instancedNode.active = false;\r\n        this.instancedNode.parent = this.defaultParent;\r\n        this.isBorrowed = false;\r\n    }\r\n}\r\n"]}